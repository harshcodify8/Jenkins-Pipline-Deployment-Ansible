#!/usr/bin/env groovy
@Library('jenkins-shared-library@master') _
pipeline{
        agent any 
        tools
        {
        	maven 'M3'
        	jdk 'java'	
        }
        
stages{
        stage('Build'){
         steps{
         	sh 'mvn compile'
         }
       }  
       
       stage('QA with SonarQube')
       {
       		steps{
       			withSonarQubeEnv('sonar'){
       			sh 'mvn clean package sonar:sonar'
       			 }
   			}
       } 
        
stage('Check Logs')
        {
         steps
                {
                 filterLogs ('WARNING',1)       
                }
        }
        
 stage('Deploy')
      {
      	steps{
        sh 'ansible-playbook demo.yml'	
       	}
       }  
     }     
  }
